{"version":3,"sources":["covid_mobility.js"],"names":["margin","top","right","bottom","left","width","window","innerWidth","height","innerHeight","data","stateSet","Set","line_svg","confirm_line","driving_line","dataFilter","x","d3v6","scaleTime","range","y0","scaleLinear","y1","xAxis","axisBottom","yAxisLeft","axisLeft","yAxisRight","axisRight","parseTime","timeParse","csv","covidData","then","d","forEach","row","add","state","push","date","Confirmed","daily_cases","driving","percentage","drawMenu","filterData","initializeCanvas","select","on","selectedOption","property","update","filter","selectedGroup","drawGraph","brush","brushX","extent","updateChart","idleTimeout","idled","event","selection","setTimeout","domain","invert","call","move","transition","duration","attr","selectAll","enter","append","text","tweenDash","l","getTotalLength","i","interpolateString","t","path","attrTween","max","Math","line","y","datum","style","maxPercent","ma","abs","mi","min","m"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACC,YAAD,EAAgB;AAChB;AAEA;;;AACA,IAAIA,MAAM,GAAG;AAAEC,EAAAA,GAAG,EAAE,EAAP;AAAWC,EAAAA,KAAK,EAAE,EAAlB;AAAsBC,EAAAA,MAAM,EAAE,EAA9B;AAAkCC,EAAAA,IAAI,EAAE;AAAxC,CAAb;AAAA,IACCC,KAAK,GAAGC,MAAM,CAACC,UAAP,IAAqBP,MAAM,CAACI,IAAP,GAAcJ,MAAM,CAACE,KAA1C,CADT;AAAA,IAECM,MAAM,GAAGF,MAAM,CAACG,WAAP,GAAqB,CAArB,IAA0BT,MAAM,CAACC,GAAP,GAAaD,MAAM,CAACG,MAA9C,CAFV;AAGA,IAAIO,IAAI,GAAG,EAAX;AACA,IAAIC,QAAQ,GAAG,IAAIC,GAAJ,EAAf;AACA,IAAIC,QAAQ,GAAG,IAAf;AACA,IAAIC,YAAY,GAAG,IAAnB;AACA,IAAIC,YAAY,GAAG,IAAnB;AAEA,IAAIC,UAAU,GAAG,IAAjB;AACA,IAAIC,CAAC,GAAGC,IAAI,CAACC,SAAL,GAAiBC,KAAjB,CAAuB,CAAC,CAAD,EAAIf,KAAJ,CAAvB,CAAR;AACA,IAAIgB,EAAE,GAAGH,IAAI,CAACI,WAAL,GAAmBF,KAAnB,CAAyB,CAACZ,MAAD,EAAS,CAAT,CAAzB,CAAT;AACA,IAAIe,EAAE,GAAGL,IAAI,CAACI,WAAL,GAAmBF,KAAnB,CAAyB,CAACZ,MAAD,EAAS,CAAT,CAAzB,CAAT;AAEA,IAAIgB,KAAK,GAAGN,IAAI,CAACO,UAAL,CAAgBR,CAAhB,CAAZ;AACA,IAAIS,SAAS,GAAGR,IAAI,CAACS,QAAL,CAAcN,EAAd,CAAhB;AACA,IAAIO,UAAU,GAAGV,IAAI,CAACW,SAAL,CAAeN,EAAf,CAAjB;AACA,IAAIO,SAAS,GAAGZ,IAAI,CAACa,SAAL,CAAe,UAAf,CAAhB,EACA;;AACAb,IAAI,CAACc,GAAL,CAASC,uBAAT,EAAoBC,IAApB,CAAyB,UAAUC,CAAV,EAAa;AACrCA,EAAAA,CAAC,CAACC,OAAF,CAAU,UAAUC,GAAV,EAAe;AACxB1B,IAAAA,QAAQ,CAAC2B,GAAT,CAAaD,GAAG,CAACE,KAAjB;AACA7B,IAAAA,IAAI,CAAC8B,IAAL,CAAU;AACTC,MAAAA,IAAI,EAAEX,SAAS,CAACO,GAAG,CAACI,IAAL,CADN;AAETC,MAAAA,SAAS,EAAEL,GAAG,CAACM,WAFN;AAGTC,MAAAA,OAAO,EAAEP,GAAG,CAACQ,UAHJ;AAITN,MAAAA,KAAK,EAAEF,GAAG,CAACE;AAJF,KAAV;AAMA,GARD;AASAO,EAAAA,QAAQ;AACR9B,EAAAA,UAAU,GAAG+B,UAAU,CAAC,SAAD,CAAvB;AACAlC,EAAAA,QAAQ,GAAGmC,gBAAgB,CAAChC,UAAD,CAA3B;AACA,CAbD;AAcAE,IAAI,CAAC+B,MAAL,CAAY,eAAZ,EAA6BC,EAA7B,CAAgC,QAAhC,EAA0C,UAAUf,CAAV,EAAa;AACtD;AACA,MAAIgB,cAAc,GAAGjC,IAAI,CAAC+B,MAAL,CAAY,IAAZ,EAAkBG,QAAlB,CAA2B,OAA3B,CAArB,CAFsD,CAGtD;;AACAC,EAAAA,MAAM,CAACF,cAAD,CAAN;AACA,CALD;;AAOA,SAASJ,UAAT,CAAoBR,KAApB,EAA2B;AAC1B,MAAIvB,UAAU,GAAGN,IAAI,CAAC4C,MAAL,CAAY,UAAUjB,GAAV,EAAe;AAC3C,WAAOA,GAAG,CAAC,OAAD,CAAH,IAAgBE,KAAvB;AACA,GAFgB,CAAjB;AAGA,SAAOvB,UAAP;AACA;;AACD,SAASqC,MAAT,CAAgBE,aAAhB,EAA+B;AAC9B;AACA;AACAvC,EAAAA,UAAU,GAAG+B,UAAU,CAACQ,aAAD,CAAvB;AACAC,EAAAA,SAAS,CAACxC,UAAD,EAAauC,aAAb,CAAT;AACA,EAED;;;AACA,IAAIE,KAAK,GAAGvC,IAAI,CACdwC,MADU,GACD;AADC,CAEVC,MAFU,CAEH,CACP,CAAC,CAAD,EAAI,CAAJ,CADO,EAEP,CAACtD,KAAD,EAAQG,MAAR,CAFO,CAFG,EAKR;AALQ,CAMV0C,EANU,CAMP,KANO,EAMAU,WANA,CAAZ,EAQA;;AACA,IAAIC,WAAJ;;AACA,SAASC,KAAT,GAAiB;AAChBD,EAAAA,WAAW,GAAG,IAAd;AACA,EAED;;;AACA,SAASD,WAAT,CAAqBG,KAArB,EAA4B;AAC3B;AACA,MAAMJ,MAAM,GAAGI,KAAK,CAACC,SAArB,CAF2B,CAI3B;;AACA,MAAI,CAACL,MAAL,EAAa;AACZ,QAAI,CAACE,WAAL,EAAkB,OAAQA,WAAW,GAAGI,UAAU,CAACH,KAAD,EAAQ,GAAR,CAAhC,CADN,CACqD;;AACjE7C,IAAAA,CAAC,CAACiD,MAAF,CACChD,IAAI,CAACyC,MAAL,CAAY3C,UAAZ,EAAwB,UAAUmB,CAAV,EAAa;AACpC,aAAOA,CAAC,CAACM,IAAT;AACA,KAFD,CADD;AAKA,GAPD,MAOO;AACNxB,IAAAA,CAAC,CAACiD,MAAF,CAAS,CAACjD,CAAC,CAACkD,MAAF,CAASR,MAAM,CAAC,CAAD,CAAf,CAAD,EAAsB1C,CAAC,CAACkD,MAAF,CAASR,MAAM,CAAC,CAAD,CAAf,CAAtB,CAAT,EADM,CAEN;;AACA9C,IAAAA,QAAQ,CAACuD,IAAT,CAAcX,KAAd,EAAqBW,IAArB,CAA0BX,KAAK,CAACY,IAAhC,EAAsC,IAAtC;AACA,GAhB0B,CAkB3B;;;AACAxD,EAAAA,QAAQ,CAACoC,MAAT,CAAgB,SAAhB,EAA2BqB,UAA3B,GAAwCC,QAAxC,CAAiD,IAAjD,EAAuDH,IAAvD,CAA4D5C,KAA5D;AACAX,EAAAA,QAAQ,CACNoC,MADF,CACS,eADT,EAEEqB,UAFF,GAGEC,QAHF,CAGW,IAHX,EAIEC,IAJF,CAIO,GAJP,EAIY1D,YAJZ;AAKAD,EAAAA,QAAQ,CACNoC,MADF,CACS,eADT,EAEEqB,UAFF,GAGEC,QAHF,CAGW,IAHX,EAIEC,IAJF,CAIO,GAJP,EAIYzD,YAJZ;AAKA,EAED;;;AAEA,SAAS+B,QAAT,GAAoB;AACnB5B,EAAAA,IAAI,CAAC+B,MAAL,CAAY,eAAZ,EACEwB,SADF,CACY,WADZ,EAEE/D,IAFF,CAEOC,QAFP,EAGE+D,KAHF,GAIEC,MAJF,CAIS,QAJT,EAKEC,IALF,CAKO,UAAUzC,CAAV,EAAa;AAClB,WAAOA,CAAP;AACA,GAPF,EAOI;AAPJ,GAQEqC,IARF,CAQO,OARP,EAQgB,UAAUrC,CAAV,EAAa;AAC3B,WAAOA,CAAP;AACA,GAVF;AAWA,EACD;;;AACA,SAAS0C,SAAT,GAAqB;AACpB,MAAMC,CAAC,GAAG,KAAKC,cAAL,EAAV;AAAA,MACCC,CAAC,GAAG9D,IAAI,CAAC+D,iBAAL,CAAuB,OAAOH,CAA9B,EAAiCA,CAAC,GAAG,GAAJ,GAAUA,CAA3C,CADL;AAEA,SAAO,UAAUI,CAAV,EAAa;AACnB,WAAOF,CAAC,CAACE,CAAD,CAAR;AACA,GAFD;AAGA;;AACD,SAASZ,UAAT,CAAoBa,IAApB,EAA0B;AAAA;;AACzBA,EAAAA,IAAI,CACFb,UADF,GAEEC,QAFF,CAEW,IAFX,EAGEa,SAHF,CAGY,kBAHZ,EAGgCP,SAHhC,EAIE3B,EAJF,CAIK,KAJL,EAIY,YAAM;AAChBhC,IAAAA,IAAI,CAAC+B,MAAL,CAAY,KAAZ,EAAkBmB,IAAlB,CAAuBE,UAAvB;AACA,GANF;AAOA;;AACD,SAAStB,gBAAT,CAA0BhC,UAA1B,EAAsC;AACrCC,EAAAA,CAAC,CAACiD,MAAF,CACChD,IAAI,CAACyC,MAAL,CAAY3C,UAAZ,EAAwB,UAAUmB,CAAV,EAAa;AACpC,WAAOA,CAAC,CAACM,IAAT;AACA,GAFD,CADD;AAKApB,EAAAA,EAAE,CAAC6C,MAAH,CAAU,CACT,CADS,EAEThD,IAAI,CAACmE,GAAL,CAASrE,UAAT,EAAqB,UAAUmB,CAAV,EAAa;AACjC,WAAOmD,IAAI,CAACD,GAAL,CAASlD,CAAC,CAACO,SAAX,CAAP;AACA,GAFD,CAFS,CAAV;AAMAnB,EAAAA,EAAE,CAAC2C,MAAH,CAAU,CAAC,CAAC,GAAF,EAAO,GAAP,CAAV;AACApD,EAAAA,YAAY,GAAGI,IAAI,CACjBqE,IADa,GAEbtE,CAFa,CAEX,UAAUkB,CAAV,EAAa;AACf,WAAOlB,CAAC,CAACkB,CAAC,CAACM,IAAH,CAAR;AACA,GAJa,EAKb+C,CALa,CAKX,UAAUrD,CAAV,EAAa;AACf,WAAOd,EAAE,CAACc,CAAC,CAACO,SAAH,CAAT;AACA,GAPa,CAAf,CAbqC,CAsBrC;;AACA3B,EAAAA,YAAY,GAAGG,IAAI,CACjBqE,IADa,GAEbtE,CAFa,CAEX,UAAUkB,CAAV,EAAa;AACf,WAAOlB,CAAC,CAACkB,CAAC,CAACM,IAAH,CAAR;AACA,GAJa,EAKb+C,CALa,CAKX,UAAUrD,CAAV,EAAa;AACf,WAAOZ,EAAE,CAACY,CAAC,CAACS,OAAH,CAAT;AACA,GAPa,CAAf;AASA/B,EAAAA,QAAQ,GAAGK,IAAI,CACb+B,MADS,CACF,YADE,EAET0B,MAFS,CAEF,KAFE,EAGTH,IAHS,CAGJ,OAHI,EAGKnE,KAAK,GAAGL,MAAM,CAACI,IAAf,GAAsBJ,MAAM,CAACE,KAHlC,EAITsE,IAJS,CAIJ,QAJI,EAIMhE,MAAM,GAAGR,MAAM,CAACC,GAAhB,GAAsBD,MAAM,CAACG,MAJnC,EAKTwE,MALS,CAKF,GALE,EAMTH,IANS,CAOT,WAPS,EAQT,eAAexE,MAAM,CAACI,IAAP,GAAc,CAA7B,GAAiC,GAAjC,GAAuCJ,MAAM,CAACC,GAA9C,GAAoD,GAR3C,CAAX;AAWAY,EAAAA,QAAQ,CACN8D,MADF,CACS,MADT,EAEEc,KAFF,CAEQzE,UAFR,EAEoB;AAFpB,GAGEwD,IAHF,CAGO,OAHP,EAGgB,cAHhB,EAIEA,IAJF,CAIO,GAJP,EAIY1D,YAJZ,EA3CqC,CAgDrC;;AAEAD,EAAAA,QAAQ,CACN8D,MADF,CACS,MADT,EAEEc,KAFF,CAEQzE,UAFR,EAEoB;AAFpB,GAGEwD,IAHF,CAGO,OAHP,EAGgB,cAHhB,EAIEA,IAJF,CAIO,GAJP,EAIYzD,YAJZ,EAlDqC,CAuDrC;AACA;;AACAF,EAAAA,QAAQ,CAAC8D,MAAT,CAAgB,GAAhB,EAAqBH,IAArB,CAA0B,OAA1B,EAAmC,OAAnC,EAA4CJ,IAA5C,CAAiDX,KAAjD;AAEA5C,EAAAA,QAAQ,CACN8D,MADF,CACS,GADT,EACc;AADd,GAEEH,IAFF,CAEO,OAFP,EAEgB,OAFhB,EAGEA,IAHF,CAGO,WAHP,EAGoB,iBAAiBhE,MAAjB,GAA0B,GAH9C,EAIE4D,IAJF,CAIO5C,KAJP;AAMAX,EAAAA,QAAQ,CAAC8D,MAAT,CAAgB,GAAhB,EAAqBH,IAArB,CAA0B,OAA1B,EAAmC,eAAnC,EAAoDJ,IAApD,CAAyD1C,SAAzD;AAEAb,EAAAA,QAAQ,CACN8D,MADF,CACS,GADT,EAEEH,IAFF,CAEO,OAFP,EAEgB,SAFhB,EAGEA,IAHF,CAGO,WAHP,EAGoB,eAAenE,KAAf,GAAuB,MAH3C,EAIE+D,IAJF,CAIOxC,UAJP;AAKAf,EAAAA,QAAQ,CACN8D,MADF,CACS,MADT,EAEEH,IAFF,CAEO,aAFP,EAEsB,KAFtB,EAGEA,IAHF,CAGO,GAHP,EAGYnE,KAAK,GAAG,CAHpB,EAIEmE,IAJF,CAIO,GAJP,EAIYhE,MAAM,GAAG,EAJrB,EAKEgE,IALF,CAKO,OALP,EAKgB,MALhB,EAMEkB,KANF,CAMQ,aANR,EAMuB,QANvB,EAOEd,IAPF,CAOO,MAPP;AAQA/D,EAAAA,QAAQ,CACN8D,MADF,CACS,MADT,EAEEH,IAFF,CAEO,aAFP,EAEsB,KAFtB,EAGEA,IAHF,CAGO,GAHP,EAGYnE,KAAK,GAAG,CAHpB,EAIEmE,IAJF,CAIO,GAJP,EAIY,CAAC,EAJb,EAKEA,IALF,CAKO,OALP,EAKgB,OALhB,EAMEkB,KANF,CAMQ,aANR,EAMuB,QANvB,EAOEd,IAPF,CAOO,0CAPP;AAQA/D,EAAAA,QAAQ,CACN8D,MADF,CACS,MADT,EAEEH,IAFF,CAEO,WAFP,EAEoB,aAFpB,EAGEA,IAHF,CAGO,GAHP,EAGY,KAAKxE,MAAM,CAACI,IAHxB,EAIEoE,IAJF,CAIO,GAJP,EAIY,IAAIhE,MAAM,GAAG,CAJzB,EAKEgE,IALF,CAKO,IALP,EAKa,KALb,EAMEkB,KANF,CAMQ,aANR,EAMuB,QANvB,EAOEd,IAPF,CAOO,cAPP;AASA/D,EAAAA,QAAQ,CACN8D,MADF,CACS,MADT,EAEEH,IAFF,CAEO,WAFP,EAEoB,aAFpB,EAGEA,IAHF,CAGO,GAHP,EAGY,KAAKnE,KAHjB,EAIEmE,IAJF,CAIO,GAJP,EAIY,IAAIhE,MAAM,GAAG,CAJzB,EAKEgE,IALF,CAKO,IALP,EAKa,KALb,EAMEkB,KANF,CAMQ,aANR,EAMuB,QANvB,EAOEd,IAPF,CAOO,mCAPP;AAQA/D,EAAAA,QAAQ,CACN8D,MADF,CACS,MADT,EAEEA,MAFF,CAES,mBAFT,EAGEH,IAHF,CAGO,IAHP,EAGa,MAHb,EAIEG,MAJF,CAIS,eAJT,EAKEH,IALF,CAKO,OALP,EAKgBnE,KALhB,EAMEmE,IANF,CAMO,QANP,EAMiBhE,MANjB,EAOEgE,IAPF,CAOO,GAPP,EAOY,CAPZ,EAQEA,IARF,CAQO,GARP,EAQY,CARZ;AASA3D,EAAAA,QAAQ,CAAC8D,MAAT,CAAgB,GAAhB,EAAqBH,IAArB,CAA0B,WAA1B,EAAuC,YAAvC;AACA3D,EAAAA,QAAQ,CAAC8D,MAAT,CAAgB,GAAhB,EAAqBH,IAArB,CAA0B,OAA1B,EAAmC,OAAnC,EAA4CJ,IAA5C,CAAiDX,KAAjD;AAEA5C,EAAAA,QAAQ,CAACqC,EAAT,CAAY,UAAZ,EAAwB,YAAY;AACnCjC,IAAAA,CAAC,CAACiD,MAAF,CACChD,IAAI,CAACyC,MAAL,CAAY3C,UAAZ,EAAwB,UAAUmB,CAAV,EAAa;AACpC,aAAOA,CAAC,CAACM,IAAT;AACA,KAFD,CADD;AAKA5B,IAAAA,QAAQ,CAACoC,MAAT,CAAgB,SAAhB,EAA2BqB,UAA3B,GAAwCC,QAAxC,CAAiD,IAAjD,EAAuDH,IAAvD,CAA4D5C,KAA5D;AACAX,IAAAA,QAAQ,CACNoC,MADF,CACS,eADT,EAEEqB,UAFF,GAGEC,QAHF,CAGW,IAHX,EAIEC,IAJF,CAIO,GAJP,EAIY1D,YAJZ;AAKAD,IAAAA,QAAQ,CACNoC,MADF,CACS,eADT,EAEEqB,UAFF,GAGEC,QAHF,CAGW,IAHX,EAIEC,IAJF,CAIO,GAJP,EAIYzD,YAJZ;AAKA,GAjBD;AAkBA,SAAOF,QAAP;AACA;;AAED,SAAS2C,SAAT,CAAmBxC,UAAnB,EAA+BuB,KAA/B,EAAsC;AACrCtB,EAAAA,CAAC,CAACiD,MAAF,CACChD,IAAI,CAACyC,MAAL,CAAY3C,UAAZ,EAAwB,UAAUmB,CAAV,EAAa;AACpC,WAAOA,CAAC,CAACM,IAAT;AACA,GAFD,CADD;AAKApB,EAAAA,EAAE,CAAC6C,MAAH,CAAU,CACT,CADS,EAEThD,IAAI,CAACmE,GAAL,CAASrE,UAAT,EAAqB,UAAUmB,CAAV,EAAa;AACjC,WAAOmD,IAAI,CAACD,GAAL,CAASlD,CAAC,CAACO,SAAX,CAAP;AACA,GAFD,CAFS,CAAV;AAMA,MAAMiD,UAAU,GAAGzE,IAAI,CAACmE,GAAL,CAASrE,UAAT,EAAqB,UAAUmB,CAAV,EAAa;AACpD,QAAMyD,EAAE,GAAGN,IAAI,CAACO,GAAL,CAASP,IAAI,CAACD,GAAL,CAASlD,CAAC,CAACS,OAAX,CAAT,CAAX;AACA,QAAMkD,EAAE,GAAGR,IAAI,CAACO,GAAL,CAASP,IAAI,CAACS,GAAL,CAAS5D,CAAC,CAACS,OAAX,CAAT,CAAX;AACA,QAAMoD,CAAC,GAAGV,IAAI,CAACD,GAAL,CAASO,EAAT,EAAaE,EAAb,CAAV;;AACA,QAAIE,CAAC,GAAG,GAAJ,GAAU,EAAd,EAAkB;AACjB,aAAOA,CAAC,GAAIA,CAAC,GAAG,GAAT,GAAgB,GAAvB;AACA,KAFD,MAEO;AACN,aAAOA,CAAC,GAAIA,CAAC,GAAG,GAAT,GAAgB,EAAvB;AACA;AACD,GATkB,CAAnB;AAUAzE,EAAAA,EAAE,CAAC2C,MAAH,CAAU,CAAC,CAACyB,UAAF,EAAcA,UAAd,CAAV;AAEAzE,EAAAA,IAAI,CAAC+B,MAAL,CAAY,eAAZ,EACEwC,KADF,CACQzE,UADR,EACoB;AADpB,GAEEsD,UAFF,GAGEC,QAHF,CAGW,IAHX,EAIEC,IAJF,CAIO,GAJP,EAIY1D,YAJZ;AAMAI,EAAAA,IAAI,CAAC+B,MAAL,CAAY,eAAZ,EACEwC,KADF,CACQzE,UADR,EACoB;AADpB,GAEEsD,UAFF,GAGEC,QAHF,CAGW,IAHX,EAIEC,IAJF,CAIO,GAJP,EAIYzD,YAJZ;AAMAF,EAAAA,QAAQ,CACNoC,MADF,CACS,YADT,EAEE2B,IAFF,2CAE0CrC,KAF1C;AAIA1B,EAAAA,QAAQ,CACNoC,MADF,CACS,iBADT,EAEEqB,UAFF,GAGEC,QAHF,CAGW,IAHX,EAIEH,IAJF,CAIO1C,SAJP;AAMAb,EAAAA,QAAQ,CAACoC,MAAT,CAAgB,WAAhB,EAA6BqB,UAA7B,GAA0CC,QAA1C,CAAmD,IAAnD,EAAyDH,IAAzD,CAA8DxC,UAA9D;AAEAf,EAAAA,QAAQ,CACNoC,MADF,CACS,SADT,EACoB;AADpB,GAEEqB,UAFF,GAGEC,QAHF,CAGW,IAHX,EAIEH,IAJF,CAIO5C,KAJP;AAKA","file":"covid_mobility.ac8cabaf.js","sourceRoot":"..\\src","sourcesContent":["import covidData from \"../static/covid_mobility.csv\";\r\n(\"use strict\"); // the code should be executed in \"strict mode\".\r\n// With strict mode, you can not, for example, use undeclared variables\r\n\r\n// preparation for our svg\r\nvar margin = { top: 50, right: 35, bottom: 50, left: 150 },\r\n\twidth = window.innerWidth - (margin.left + margin.right),\r\n\theight = window.innerHeight / 2 - (margin.top + margin.bottom);\r\nvar data = [];\r\nvar stateSet = new Set();\r\nvar line_svg = null;\r\nvar confirm_line = null;\r\nvar driving_line = null;\r\n\r\nvar dataFilter = null;\r\nvar x = d3v6.scaleTime().range([0, width]);\r\nvar y0 = d3v6.scaleLinear().range([height, 0]);\r\nvar y1 = d3v6.scaleLinear().range([height, 0]);\r\n\r\nvar xAxis = d3v6.axisBottom(x);\r\nvar yAxisLeft = d3v6.axisLeft(y0);\r\nvar yAxisRight = d3v6.axisRight(y1);\r\nvar parseTime = d3v6.timeParse(\"%Y-%m-%d\");\r\n// Get the data\r\nd3v6.csv(covidData).then(function (d) {\r\n\td.forEach(function (row) {\r\n\t\tstateSet.add(row.state);\r\n\t\tdata.push({\r\n\t\t\tdate: parseTime(row.date),\r\n\t\t\tConfirmed: row.daily_cases,\r\n\t\t\tdriving: row.percentage,\r\n\t\t\tstate: row.state,\r\n\t\t});\r\n\t});\r\n\tdrawMenu();\r\n\tdataFilter = filterData(\"Alabama\");\r\n\tline_svg = initializeCanvas(dataFilter);\r\n});\r\nd3v6.select(\"#selectButton\").on(\"change\", function (d) {\r\n\t// recover the option that has been chosen\r\n\tvar selectedOption = d3v6.select(this).property(\"value\");\r\n\t// run the updateChart function with this selected option\r\n\tupdate(selectedOption);\r\n});\r\n\r\nfunction filterData(state) {\r\n\tvar dataFilter = data.filter(function (row) {\r\n\t\treturn row[\"state\"] == state;\r\n\t});\r\n\treturn dataFilter;\r\n}\r\nfunction update(selectedGroup) {\r\n\t// Create new data with the selection?\r\n\t// Give these new data to update line\r\n\tdataFilter = filterData(selectedGroup);\r\n\tdrawGraph(dataFilter, selectedGroup);\r\n}\r\n\r\n// Add the brushing\r\nvar brush = d3v6\r\n\t.brushX() // Add the brush feature using the d3v6.brush function\r\n\t.extent([\r\n\t\t[0, 0],\r\n\t\t[width, height],\r\n\t]) // initialise the brush area: start at 0,0 and finishes at width,height: it means I select the whole graph area\r\n\t.on(\"end\", updateChart);\r\n\r\n// A function that set idleTimeOut to null\r\nvar idleTimeout;\r\nfunction idled() {\r\n\tidleTimeout = null;\r\n}\r\n\r\n// A function that update the chart for given boundaries\r\nfunction updateChart(event) {\r\n\t// What are the selected boundaries?\r\n\tconst extent = event.selection;\r\n\r\n\t// If no selection, back to initial coordinate. Otherwise, update X axis domain\r\n\tif (!extent) {\r\n\t\tif (!idleTimeout) return (idleTimeout = setTimeout(idled, 350)); // This allows to wait a little bit\r\n\t\tx.domain(\r\n\t\t\td3v6.extent(dataFilter, function (d) {\r\n\t\t\t\treturn d.date;\r\n\t\t\t})\r\n\t\t);\r\n\t} else {\r\n\t\tx.domain([x.invert(extent[0]), x.invert(extent[1])]);\r\n\t\t// line_svg.select(\".brush\").call(brush.move, null); // This remove the grey brush area as soon as the selection has been done\r\n\t\tline_svg.call(brush).call(brush.move, null);\r\n\t}\r\n\r\n\t// Update axis and line position\r\n\tline_svg.select(\"g.xAxis\").transition().duration(1000).call(xAxis);\r\n\tline_svg\r\n\t\t.select(\".confirm_line\")\r\n\t\t.transition()\r\n\t\t.duration(1000)\r\n\t\t.attr(\"d\", confirm_line);\r\n\tline_svg\r\n\t\t.select(\".driving_line\")\r\n\t\t.transition()\r\n\t\t.duration(1000)\r\n\t\t.attr(\"d\", driving_line);\r\n}\r\n\r\n// If user double click, reinitialize the chart\r\n\r\nfunction drawMenu() {\r\n\td3v6.select(\"#selectButton\")\r\n\t\t.selectAll(\"myOptions\")\r\n\t\t.data(stateSet)\r\n\t\t.enter()\r\n\t\t.append(\"option\")\r\n\t\t.text(function (d) {\r\n\t\t\treturn d;\r\n\t\t}) // text showed in the menu\r\n\t\t.attr(\"value\", function (d) {\r\n\t\t\treturn d;\r\n\t\t});\r\n}\r\n// Scale the range of the data\r\nfunction tweenDash() {\r\n\tconst l = this.getTotalLength(),\r\n\t\ti = d3v6.interpolateString(\"0,\" + l, l + \",\" + l);\r\n\treturn function (t) {\r\n\t\treturn i(t);\r\n\t};\r\n}\r\nfunction transition(path) {\r\n\tpath\r\n\t\t.transition()\r\n\t\t.duration(5000)\r\n\t\t.attrTween(\"stroke-dasharray\", tweenDash)\r\n\t\t.on(\"end\", () => {\r\n\t\t\td3v6.select(this).call(transition);\r\n\t\t});\r\n}\r\nfunction initializeCanvas(dataFilter) {\r\n\tx.domain(\r\n\t\td3v6.extent(dataFilter, function (d) {\r\n\t\t\treturn d.date;\r\n\t\t})\r\n\t);\r\n\ty0.domain([\r\n\t\t0,\r\n\t\td3v6.max(dataFilter, function (d) {\r\n\t\t\treturn Math.max(d.Confirmed);\r\n\t\t}),\r\n\t]);\r\n\ty1.domain([-200, 200]);\r\n\tconfirm_line = d3v6\r\n\t\t.line()\r\n\t\t.x(function (d) {\r\n\t\t\treturn x(d.date);\r\n\t\t})\r\n\t\t.y(function (d) {\r\n\t\t\treturn y0(d.Confirmed);\r\n\t\t});\r\n\r\n\t// this is the mobility percentage\r\n\tdriving_line = d3v6\r\n\t\t.line()\r\n\t\t.x(function (d) {\r\n\t\t\treturn x(d.date);\r\n\t\t})\r\n\t\t.y(function (d) {\r\n\t\t\treturn y1(d.driving);\r\n\t\t});\r\n\r\n\tline_svg = d3v6\r\n\t\t.select(\"#d3v6-demo\")\r\n\t\t.append(\"svg\")\r\n\t\t.attr(\"width\", width + margin.left + margin.right)\r\n\t\t.attr(\"height\", height + margin.top + margin.bottom)\r\n\t\t.append(\"g\")\r\n\t\t.attr(\r\n\t\t\t\"transform\",\r\n\t\t\t\"translate(\" + margin.left / 2 + \",\" + margin.top + \")\"\r\n\t\t);\r\n\r\n\tline_svg\r\n\t\t.append(\"path\")\r\n\t\t.datum(dataFilter) // Add the confirm line path.\r\n\t\t.attr(\"class\", \"confirm_line\")\r\n\t\t.attr(\"d\", confirm_line);\r\n\t// .call(transition);\r\n\r\n\tline_svg\r\n\t\t.append(\"path\")\r\n\t\t.datum(dataFilter) // Add the confirmline2 path.\r\n\t\t.attr(\"class\", \"driving_line\")\r\n\t\t.attr(\"d\", driving_line);\r\n\t// .call(transition);\r\n\t// add line brush\r\n\tline_svg.append(\"g\").attr(\"class\", \"brush\").call(brush);\r\n\r\n\tline_svg\r\n\t\t.append(\"g\") // Add the X Axis\r\n\t\t.attr(\"class\", \"xAxis\")\r\n\t\t.attr(\"transform\", \"translate(0,\" + height + \")\")\r\n\t\t.call(xAxis);\r\n\r\n\tline_svg.append(\"g\").attr(\"class\", \"axisSteelBlue\").call(yAxisLeft);\r\n\r\n\tline_svg\r\n\t\t.append(\"g\")\r\n\t\t.attr(\"class\", \"axisRed\")\r\n\t\t.attr(\"transform\", \"translate(\" + width + \" ,0)\")\r\n\t\t.call(yAxisRight);\r\n\tline_svg\r\n\t\t.append(\"text\")\r\n\t\t.attr(\"text-anchor\", \"end\")\r\n\t\t.attr(\"x\", width / 2)\r\n\t\t.attr(\"y\", height + 30)\r\n\t\t.attr(\"class\", \"date\")\r\n\t\t.style(\"text-anchor\", \"middle\")\r\n\t\t.text(\"Date\");\r\n\tline_svg\r\n\t\t.append(\"text\")\r\n\t\t.attr(\"text-anchor\", \"end\")\r\n\t\t.attr(\"x\", width / 2)\r\n\t\t.attr(\"y\", -10)\r\n\t\t.attr(\"class\", \"title\")\r\n\t\t.style(\"text-anchor\", \"middle\")\r\n\t\t.text(\"Weekly Case Vs Weekly Mobility (Alabama)\");\r\n\tline_svg\r\n\t\t.append(\"text\")\r\n\t\t.attr(\"transform\", \"rotate(-90)\")\r\n\t\t.attr(\"y\", 80 - margin.left)\r\n\t\t.attr(\"x\", 0 - height / 2)\r\n\t\t.attr(\"dy\", \"1em\")\r\n\t\t.style(\"text-anchor\", \"middle\")\r\n\t\t.text(\"Weekly Cases\");\r\n\r\n\tline_svg\r\n\t\t.append(\"text\")\r\n\t\t.attr(\"transform\", \"rotate(-90)\")\r\n\t\t.attr(\"y\", 30 + width)\r\n\t\t.attr(\"x\", 0 - height / 2)\r\n\t\t.attr(\"dy\", \"1em\")\r\n\t\t.style(\"text-anchor\", \"middle\")\r\n\t\t.text(\"Weekly Mobility Percentage Change\");\r\n\tline_svg\r\n\t\t.append(\"defs\")\r\n\t\t.append(\"line_svg:clipPath\")\r\n\t\t.attr(\"id\", \"clip\")\r\n\t\t.append(\"line_svg:rect\")\r\n\t\t.attr(\"width\", width)\r\n\t\t.attr(\"height\", height)\r\n\t\t.attr(\"x\", 0)\r\n\t\t.attr(\"y\", 0);\r\n\tline_svg.append(\"g\").attr(\"clip-path\", \"url(#clip)\");\r\n\tline_svg.append(\"g\").attr(\"class\", \"brush\").call(brush);\r\n\r\n\tline_svg.on(\"dblclick\", function () {\r\n\t\tx.domain(\r\n\t\t\td3v6.extent(dataFilter, function (d) {\r\n\t\t\t\treturn d.date;\r\n\t\t\t})\r\n\t\t);\r\n\t\tline_svg.select(\"g.xAxis\").transition().duration(1000).call(xAxis);\r\n\t\tline_svg\r\n\t\t\t.select(\".confirm_line\")\r\n\t\t\t.transition()\r\n\t\t\t.duration(1000)\r\n\t\t\t.attr(\"d\", confirm_line);\r\n\t\tline_svg\r\n\t\t\t.select(\".driving_line\")\r\n\t\t\t.transition()\r\n\t\t\t.duration(1000)\r\n\t\t\t.attr(\"d\", driving_line);\r\n\t});\r\n\treturn line_svg;\r\n}\r\n\r\nfunction drawGraph(dataFilter, state) {\r\n\tx.domain(\r\n\t\td3v6.extent(dataFilter, function (d) {\r\n\t\t\treturn d.date;\r\n\t\t})\r\n\t);\r\n\ty0.domain([\r\n\t\t0,\r\n\t\td3v6.max(dataFilter, function (d) {\r\n\t\t\treturn Math.max(d.Confirmed);\r\n\t\t}),\r\n\t]);\r\n\tconst maxPercent = d3v6.max(dataFilter, function (d) {\r\n\t\tconst ma = Math.abs(Math.max(d.driving));\r\n\t\tconst mi = Math.abs(Math.min(d.driving));\r\n\t\tconst m = Math.max(ma, mi);\r\n\t\tif (m % 100 > 50) {\r\n\t\t\treturn m - (m % 100) + 100;\r\n\t\t} else {\r\n\t\t\treturn m - (m % 100) + 50;\r\n\t\t}\r\n\t});\r\n\ty1.domain([-maxPercent, maxPercent]);\r\n\r\n\td3v6.select(\".confirm_line\")\r\n\t\t.datum(dataFilter) // Add the confirmline2 path.\r\n\t\t.transition()\r\n\t\t.duration(1000)\r\n\t\t.attr(\"d\", confirm_line);\r\n\r\n\td3v6.select(\".driving_line\")\r\n\t\t.datum(dataFilter) // Add the confirmline2 path.\r\n\t\t.transition()\r\n\t\t.duration(1000)\r\n\t\t.attr(\"d\", driving_line);\r\n\r\n\tline_svg\r\n\t\t.select(\"text.title\")\r\n\t\t.text(`Weekly Case Vs Weekly Mobility (${state})`);\r\n\r\n\tline_svg\r\n\t\t.select(\"g.axisSteelBlue\")\r\n\t\t.transition()\r\n\t\t.duration(1000)\r\n\t\t.call(yAxisLeft);\r\n\r\n\tline_svg.select(\"g.axisRed\").transition().duration(1000).call(yAxisRight);\r\n\r\n\tline_svg\r\n\t\t.select(\"g.xAxis\") // Add the X Axis\r\n\t\t.transition()\r\n\t\t.duration(1000)\r\n\t\t.call(xAxis);\r\n}\r\n"]}